pipeline{
ageny any 
stages{
stage ('build'){
steps{
sh'printenv'
}
}
stage('publish ECR') {
steps{
withENV (["AWS_ACCESS_KEY_ID=${env.AWS_ACCESS_KEY_ID}","AWS_SECRET_ACCESS_KEY=${env.AWS_SECRET_ACCESS_KEY}","AWS_DEFAULT_REGION=${env.AWS_DEFAULT_REGION}"]){
sh'docker login -u AWS -p $(aws ecr get-login-password --region us-east-1 )165271113309.dkr.ecr.us-east-1.amazonaws.com
sh'docker  build -t ecr-demo .'
sh'docker tag ecr-demo :""$BUILD_ID""'
sh'docker push 165271113309.dkr.ecr.us-east-1.amazonaws.com/lamda_ply:""$BUILD_ID""'
}
}
}
}
}
